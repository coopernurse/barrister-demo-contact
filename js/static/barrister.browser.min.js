var Barrister;Barrister||(Barrister={}),function(){function b(b){var c="",d;for(d=0;d<b;d++){var e=Math.floor(Math.random()*a.length);c+=a.substring(e,e+1)}return c}function e(a,b){if(a){var e=JSON.stringify(a);return e?b?e:e.replace(c,d):e}return a}function f(a,c){var d={jsonrpc:"2.0",id:b(20),method:a};return c!==null&&c!==undefined&&(d.params=c),d}function g(a,b,c,d){return a=a||null,{jsonrpc:"2.0",id:a,error:{code:b,message:c,data:d}}}function h(a,b,c){var d;if(b)d=g(a.id,-32e3,b);else if(c!==undefined&&c!==null)if(typeof c=="object")d=c;else try{d=JSON.parse(c)}catch(e){d=g(a.id,-32700,"Unable to parse response JSON: "+c)}else d=g(a.id,-32603,"Null response body received from server");return d}function i(a){var b,c,d,e;this.idl=a,this.interfaces={},this.functions={},this.structs={},this.enums={};for(b=0;b<a.length;b++){d=a[b];if(d.type==="interface"){this.interfaces[d.name]=d;for(c=0;c<d.functions.length;c++)e=d.functions[c],this.functions[d.name+"."+e.name]=e}else d.type==="struct"?this.structs[d.name]=d:d.type==="enum"&&(this.enums[d.name]=d)}}function j(a){this.client=a,this.reqList=[]}function k(a){this.transport=a,this.trace=null}var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz",c=new RegExp("[\\u007f-\\uffff]","g"),d=function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)};i.prototype.validate=function(a,b,c,d){var e=this,f,g,h,i,j,k=[!0,null];a=a||"";if(d===null||d===undefined)return b.optional===!0?k:[!1,a+" cannot be null"];var l=typeof d;if(c===!0){if(l!=="object"||!d instanceof Array)return e.validationErr(a,"[]"+b.type,l,d);for(f=0;f<d.length;f++){j=e.validate(a+"["+f+"]",b,!1,d[f]);if(!j[0])return j}return k}if(b.type==="string")return l==="string"?k:e.validationErr(a,b.type,l,d);if(b.type==="bool")return l==="boolean"?k:e.validationErr(a,b.type,l,d);if(b.type==="int"||b.type==="float")return l!=="number"?e.validationErr(a,b.type,l,d):b.type==="int"&&d!==Math.round(d)?e.validationErr(a,b.type,"float",d):k;if(e.structs[b.type]){if(l!=="object")return e.validationErr(a,b.type,l,d);h=e.getAllStructFields([],e.structs[b.type]),i={};for(f=0;f<h.length;f++){g=h[f],j=e.validate(a+"."+g.name,g,g.is_array,d[g.name]);if(!j[0])return j;i[g.name]=1}for(f in d)if(d.hasOwnProperty(f)&&!i[f])return[!1,a+"."+g.name+" does not exist in type '"+b.type+"'"];return k}if(e.enums[b.type]){if(l!=="string")return e.validationErr(a,b.type,l,d);g=e.enums[b.type];for(f=0;f<g.values.length;f++)if(g.values[f].value===d)return k;var m=a+" value '"+d+"' is not in the enum '"+g.name+"': "+JSON.stringify(g.values);return[!1,m]}return[!1,a+" unknown type: "+b.type]},i.prototype.getAllStructFields=function(a,b){return b.fields.length>0&&(a=a.concat(b.fields)),b["extends"]?this.getAllStructFields(a,this.structs[b["extends"]]):a},i.prototype.validationErr=function(a,b,c,d){return[!1,a+" expects type '"+b+"' but got type '"+c+"' for value: "+d]},j.prototype.proxy=function(a){var b=this;return b.client._proxy(function(a){return b.functionProxy(a)},a)},j.prototype.functionProxy=function(a){var b=this;return function(){var c=Array.prototype.slice.call(arguments);b.request(a,c)}},j.prototype.send=function(a){var b=this,c=b.reqList;b.client._send(c,function(d){if(d!==null&&d!==undefined&&d instanceof Array){var e=[],f=[],h={},i,j,k;for(i=0;i<d.length;i++)j=d[i],j.id&&(h[j.id]=j);for(i=0;i<c.length;i++)c[i].id&&(j=h[c[i].id],j?(j=b.wrapResp(c[i],j),j.error?e.push():f.push(j)):(k="No response received for request id: "+c[i].id,e.push(b.wrapResp(c[i],g(-32603,k)))));a(e.length===0?null:e,f)}else a([b.wrapResp({},d)],null)})},j.prototype.wrapResp=function(a,b){return b.method=a.method,b.params=a.params,b},j.prototype.request=function(a,b){this.reqList.push(f(a,b))},k.prototype.loadContract=function(a){var b=this;b.request("barrister-idl",[],function(c,d){c?a(c):(b.contract=new i(d),a())})},k.prototype.enableTrace=function(a){a&&typeof a=="function"?this.trace=a:this.trace=function(a){console.log(a)}},k.prototype.disableTrace=function(){this.trace=null},k.prototype.batch=function(){return new j(this)},k.prototype.proxy=function(a){var b=this;return b._proxy(function(a){return b.functionProxy(a)},a)},k.prototype._proxy=function(a,b){var c=this;if(!c.contract)throw"Contract.loadContract() has not been called yet!";var d=c.contract.interfaces[b];if(d){var e={},f,g;for(f=0;f<d.functions.length;f++)g=d.functions[f],e[g.name]=a(b+"."+g.name);return e}throw"Interface not found: "+b},k.prototype.functionProxy=function(a){var b=this;return function(){var c=Array.prototype.slice.call(arguments),d=c.pop();if(d===undefined||d===null||typeof d!="function")throw"Last arg to "+a+" must be a callback function!";b.request(a,c,d)}},k.prototype.request=function(a,b,c){var d=this,e=f(a,b);d._send(e,function(a){a.error?c(a.error,null):c(null,a.result)})},k.prototype._send=function(a,b){var c=this;c.trace&&c.trace("Request: "+e(a)),c.transport(a,function(a){c.trace&&c.trace("Response: "+e(a)),b(a)})};var l=function(a){var b=a;return typeof a=="string"&&(b=function(b,c){var d={type:"POST",contentType:"application/json",data:e(b),error:function(a,d,e){c(h(b,d+" "+e,null))},success:function(a,d,e){c(h(b,null,a))}};jQuery.ajax(a,d)}),new k(b)};Barrister.httpClient=l,Barrister.parseHttpResponse=h,Barrister.Client=k,Barrister.Contract=i,Barrister.JSON_stringify=e}();